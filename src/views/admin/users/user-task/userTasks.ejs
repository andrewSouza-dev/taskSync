<%- include('../../../partials/header') %>
<%- include('../../../partials/menu', { user }) %>


<h2>Tasks vinculadas ao usuário <%= user.name %></h2>

<a href="/users/<%= user.id %>/tasks/new">Associar nova tarefa</a>

<table border="1">
  <thead>
    <tr>
      <th>ID</th>
      <th>Título</th>
      <th>Status</th>
      <th>Função</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody>
    <% if (tasks.length > 0) { %>
      <% tasks.forEach(task => { %>
        <tr>
          <td><%= task.id %></td>
          <td><%= task.title %></td>
          <td><%= task.status %></td>
          <td><%= task.role %></td>
          <td>
            <form action="/users/<%= user.id %>/tasks/<%= task.id %>?_method=DELETE" method="POST" style="display:inline;">
              <button type="submit">Remover</button>
            </form>
            <form action="/users/<%= user.id %>/tasks/<%= task.id %>?_method=PUT" method="POST" style="display:inline;">
              <select name="role">
                <option value="MEMBER" <%= task.role === 'MEMBER' ? 'selected' : '' %>>MEMBER</option>
                <option value="OWNER" <%= task.role === 'OWNER' ? 'selected' : '' %>>OWNER</option>
              </select>
              <button type="submit">Atualizar Função</button>
            </form>
          </td>
        </tr>
      <% }) %>
    <% } else { %>
      <tr><td colspan="5">Nenhuma tarefa vinculada.</td></tr>
    <% } %>
  </tbody>
</table>

<a href="/users">⬅ Voltar</a>

<%- include('../../../partials/footer') %>
